# 網頁爬蟲使用說明

## 功能說明

這個爬蟲腳本可以從 Tixcraft 和 KKTIX 等官方售票平台爬取活動資訊，並自動匯入到資料庫中。

## 關於「探索活動」頁面

「探索活動」頁面的邏輯是：
- 顯示所有活動（從 EVENT 表）
- 每個活動會統計有多少用戶上架的票券（從 LISTING 和 LISTING_ITEM 表）
- 顯示每個活動的最低和最高票價
- 點擊活動可以查看該活動的所有可售票券

這是一個**二手票券交易平台**，不是官方售票頁面。不同用戶可以上架自己的票券，系統會按活動分組顯示。

## 使用方式

### 1. 使用範例資料（預設）

```bash
cd backend
npm run scrape:events
```

這會使用內建的範例活動資料，包含：
- 五月天演唱會
- 蔡依林演唱會
- 周杰倫演唱會
- 田馥甄演唱會
- 張惠妹演唱會

### 2. 啟用實際網頁爬蟲

在 `.env` 檔案中添加：

```env
ENABLE_SCRAPING=true
```

然後執行：

```bash
npm run scrape:events
```

**注意事項：**
- 實際爬蟲可能會因為網站結構變動而失敗
- 請遵守網站的服務條款和使用規範
- 建議設定適當的延遲以避免對伺服器造成負擔
- 如果爬取失敗，腳本會自動使用範例資料作為後備

## 爬取的資料

腳本會爬取以下資訊：
- 藝人/團體名稱
- 活動標題
- 活動日期和時間
- 場館名稱、城市和地址
- **活動圖片 URL**（如果網站有提供）
- 來源平台和連結

### 關於票券資料

**座位區域資訊：**
- ✅ 可以從官方售票網站獲取座位區域資訊（如搖滾區、看台區等）
- ✅ 腳本會自動為每個場館建立預設的座位區域
- ✅ 每個座位區域包含價格區間資訊

**具體座位號碼：**
- ❌ **無法從公開頁面獲取**：具體的座位號碼（如 A1-12-18）通常需要登入帳號或購買後才能看到
- ✅ **解決方案**：腳本會自動為每個活動和座位區域建立範例票券資料
- ✅ 每個區域會建立 5-10 張範例票券，包含：
  - 座位標籤（如 A1-12-18）
  - 面額價格（根據區域價格區間）
  - 原始售票平台資訊

## 資料匯入

腳本會自動：
1. 檢查場館是否存在，不存在則建立
2. 檢查活動是否已存在（根據標題、日期和場館）
3. 匯入新活動到資料庫
4. 跳過已存在的活動

## 自訂活動資料

如果需要手動添加活動，可以直接在資料庫中執行 SQL，或修改 `scrapeEvents.ts` 中的 `loadExampleEvents()` 函數。

## 注意事項

1. **遵守服務條款**：請確保您的使用符合目標網站的服務條款
2. **合理使用**：不要過度頻繁地爬取，避免對伺服器造成負擔
3. **資料準確性**：爬取的資料可能需要人工驗證和調整
4. **網站變動**：網站結構可能會變動，需要定期更新選擇器

## 疑難排解

如果爬蟲失敗：
1. 檢查網路連線
2. 確認目標網站是否可訪問
3. 檢查網站 HTML 結構是否變動
4. 腳本會自動使用範例資料作為後備

